<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>توليد رابط الدفع</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&display=swap"
      rel="stylesheet" />
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Cairo", sans-serif;
        background: #f5f6f8;
        display: flex;
        justify-content: center;
        padding: 40px;
        height: 100vh;
        margin: 0;
      }

      .card {
        background: #fff;
        padding: 20px;
        width: 350px;
        height: fit-content;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      h2 {
        margin-bottom: 15px;
        color: #333;
      }

      input {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 16px;
      }

      button {
        width: 100%;
        padding: 12px;
        background: #92002c;
        color: #fff;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
      }

      button:hover {
        opacity: 0.9;
      }

      .link-box {
        direction: ltr;
        margin-top: 15px;
        font-size: 14px;
        word-break: break-all;
        text-align: left;
      }

      #currency option {
        padding: 4px 8px;
        border-radius: 3px;
        border: 1px solid #ccc;
        margin-bottom: 10px;
      }

      #copyBtn {
        display: none;
      }
    </style>
  </head>

  <body>
    <div class="card">
      <h2>توليد رابط دفع</h2>
      <input type="number" id="amount" placeholder="ادخل المبلغ" required />
      <input type="text" id="clientName" placeholder="اسم العميل" required />
      <input type="text" id="description" placeholder="الوصف" required />
      <label for="currency">العمله:</label>
      <select id="currency" name="currency">
        <option value="AED">AED</option>
        <option value="QAR">QAR</option>
        <option value="BHD">BHD</option>
        <option value="SAR">SAR</option>
      </select>
      <input type="text" id="merchant">

      <button onclick="generateLink()">توليد الرابط</button>
      <div class="link-box" id="linkBox"></div>
      <button id="copyBtn">Copy</button>
    </div>

    <script>
      function generateRandomNumber(length = 12) {
        let number = "";
        for (let i = 0; i < length; i++) {
          number += Math.floor(Math.random() * 10); // adds a random digit 0-9
        }
        // prevent leading zero
        if (number[0] === "0") {
          number = "1" + number.slice(1);
        }
        return number;
      }

      function generateLink() {
        const amount = document.getElementById("amount").value.trim();
        const clientName = document.getElementById("clientName").value.trim();
        const description = document.getElementById("description").value.trim();
        const linkBox = document.getElementById("linkBox");
        const currency = document.getElementById("currency").value;
        const merchant = document.getElementById("merchant").value;

        // Validation rules
        if (!/^\d+(\.\d{1,2})?$/.test(amount) || Number(amount) <= 0) {
          linkBox.innerHTML =
            "<span style='color:red'>الرجاء إدخال مبلغ صحيح (أرقام فقط)</span>";
          return;
        }

        if (!/^[\u0600-\u06FFa-zA-Z\s]{3,}$/.test(clientName)) {
          linkBox.innerHTML =
            "<span style='color:red'>اسم العميل يجب أن يحتوي على أحرف فقط (3 أحرف على الأقل)</span>";
          return;
        }

        if (description.length < 5) {
          linkBox.innerHTML =
            "<span style='color:red'>الوصف يجب أن يحتوي على 5 أحرف على الأقل</span>";
          return;
        }

        // Get base URL dynamically
        const origin = window.location.origin;
        const pathParts = window.location.pathname.split("/");
        pathParts.pop(); // remove current file (index.html)
        const basePath = pathParts.join("/");

        // Encode values for safe URL usage
        const link = `${origin}${basePath}/page1.html?amount=${encodeURIComponent(
          amount
        )}&name=${encodeURIComponent(clientName)}&desc=${encodeURIComponent(
          description)}&currency=${encodeURIComponent(
          currency
        )}`;

        linkBox.innerHTML = `
        <p>*Invoice Request - SD${generateRandomNumber()}* </pr>
        <p>Hi *${clientName}* </br>
        You have received an invoice of ${amount}.00 ${currency} from ${merchant}. </pr>
        <p>Click the link below to pay </br>
        Link: <a href="${link}" target="_blank">${link}</a> </pr>
      `;

      document.getElementById("copyBtn").style.display = "block";
      }

      document.getElementById("copyBtn").addEventListener("click", () => {
        const text = document.getElementById("linkBox").innerText;

        navigator.clipboard
          .writeText(text)
          .then(() => {
            alert("تم النسخ بنجاح");
          })
          .catch((err) => {
            console.error("خطأ في نسخ النص: ", err);
          });
      });
    </script>
  </body>
</html>




